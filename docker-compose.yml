version: '3.9'

services:

  admin:
    container_name: ${APP_NAME}-admin
    build:
      context: admin
      target: development
    ports:
      - "3000:3000"
    volumes:
      - ./admin:/usr/src/app/adminapp
      - /usr/src/app/adminapp/node_modules
    environment:
      - VIRTUAL_HOST=admin.insset.localhost
      - VIRTUAL_PORT=3000
    networks:
      - proxy

  api:
    container_name: ${APP_NAME}-backend
    build:
      context: ./backend
    command: python3 api/app.py
    ports:
      - "5000:5000"
    volumes:
      - ./backend/api:/usr/src/app/api
      - ./backend/gplib:/usr/src/app/gplib
      - ./backend/data:/usr/src/app/data
      - ./backend/ovh:/usr/src/app/ovh
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      - VIRTUAL_HOST=api.insset.localhost
      - VIRTUAL_PORT=5000
    networks:
      - proxy
